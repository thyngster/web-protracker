// ProTracker 2 bitmap font data
// Source: https://github.com/8bitbubsy/pt2-clone
// 8 pixels wide, stored as 1-bit per pixel expanded to bytes

const CHAR_WIDTH = 8;
const CHAR_HEIGHT = 7;
const CHARS_PER_ROW = 16;
const FONT_ROWS = 6;

// Font bitmap data (8x7 pixel characters, 96 characters starting from space)
// Each character is stored as 7 rows of 8 pixels
const fontData = new Uint8Array([
  // Row 0: Space ! " # $ % & ' ( ) * + , - . /
  0,0,0,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 0,1,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 1,1,0,0,1,0,0,0, 0,1,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0,
  0,0,0,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 1,1,1,1,1,0,0,0, 0,1,1,1,1,0,0,0, 1,1,0,1,0,0,0,0, 1,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,1,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,1,0,0,0,0, 1,0,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 1,1,1,1,1,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 1,1,1,1,1,0,0,0, 0,0,1,1,1,0,0,0, 0,1,0,0,0,0,0,0, 1,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,1,1,0,0,0, 0,1,1,0,1,0,0,0, 0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,

  // Row 1: 0 1 2 3 4 5 6 7 8 9 : ; < = > ?
  0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,1,0,0,0,0, 1,1,1,1,1,0,0,0, 0,0,1,1,0,0,0,0, 1,1,1,1,1,0,0,0, 0,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,1,1,1,0,0,0,0,
  1,0,0,0,1,0,0,0, 0,1,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,1,0,0,0,0, 1,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0,
  1,0,0,1,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 0,0,0,0,1,0,0,0, 0,1,0,1,0,0,0,0, 1,1,1,1,0,0,0,0, 1,0,0,0,0,0,0,0, 0,0,0,1,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,1,0,0,0,0, 0,0,0,1,0,0,0,0,
  1,0,1,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,1,1,0,0,0,0, 0,0,1,1,0,0,0,0, 1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,0, 1,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,1,1,1,1,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0,
  1,1,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,1,1,1,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 0,0,0,0,1,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  0,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,1,1,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,1,1,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,

  // Row 2: @ A B C D E F G H I J K L M N O
  0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,0,0,0,0,0, 1,1,1,1,1,0,0,0, 1,1,1,1,1,0,0,0, 0,1,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,1,0,0,0,0,
  1,0,0,0,1,0,0,0, 0,1,0,1,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,1,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,0,0,1,0,0,0,0, 1,0,0,0,0,0,0,0, 1,1,0,1,1,0,0,0, 1,1,0,0,1,0,0,0, 1,0,0,0,1,0,0,0,
  1,0,1,1,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,1,0,1,0,0,0, 1,0,1,0,1,0,0,0, 1,0,0,0,1,0,0,0,
  1,0,1,0,1,0,0,0, 1,1,1,1,1,0,0,0, 1,1,1,1,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,0,0,0,0,0, 1,1,1,0,0,0,0,0, 1,0,1,1,1,0,0,0, 1,1,1,1,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,1,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,1,0,1,0,0,0, 1,0,0,1,1,0,0,0, 1,0,0,0,1,0,0,0,
  1,0,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0,
  0,1,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,0,0,0,0,0, 1,1,1,1,1,0,0,0, 1,0,0,0,0,0,0,0, 0,1,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,1,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,1,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,

  // Row 3: P Q R S T U V W X Y Z [ \ ] ^ _
  1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,1,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,1,1,0,0,0, 0,1,1,0,0,0,0,0, 1,0,0,0,0,0,0,0, 0,0,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,1,0,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,0,0,0,1,0,0,0, 0,1,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,1,0,0,0,0, 0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,
  1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 0,0,0,1,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,0,0,0,0,0,0,0,
  1,1,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 0,1,0,1,0,0,0,0, 1,0,1,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,1,0,0,0,0, 0,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  1,0,0,0,0,0,0,0, 1,0,1,0,1,0,0,0, 1,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 0,1,0,1,0,0,0,0, 1,0,1,0,1,0,0,0, 0,1,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,0,0,1,0,0,0, 0,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  1,0,0,0,0,0,0,0, 0,1,1,0,1,0,0,0, 1,0,0,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,1,1,1,1,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,0,0,1,0,0, 0,0,1,1,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 1,1,1,1,1,0,0,0,

  // Row 4: ` a b c d e f g h i j k l m n o  (lowercase same as uppercase for PT)
  0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,0,0,0,0,0, 1,1,1,1,1,0,0,0, 1,1,1,1,1,0,0,0, 0,1,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,1,0,0,0,0, 0,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,1,0,0,0,0,
  0,0,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,1,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,0,0,1,0,0,0,0, 1,0,0,0,0,0,0,0, 1,1,0,1,1,0,0,0, 1,1,0,0,1,0,0,0, 1,0,0,0,1,0,0,0,
  0,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,1,0,1,0,0,0, 1,0,1,0,1,0,0,0, 1,0,0,0,1,0,0,0,
  0,0,0,0,0,0,0,0, 1,1,1,1,1,0,0,0, 1,1,1,1,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,0,0,0,0,0, 1,1,1,0,0,0,0,0, 1,0,1,1,1,0,0,0, 1,1,1,1,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,1,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,1,0,1,0,0,0, 1,0,0,1,1,0,0,0, 1,0,0,0,1,0,0,0,
  0,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0,
  0,0,0,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,0,0,0,0,0, 1,1,1,1,1,0,0,0, 1,0,0,0,0,0,0,0, 0,1,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,1,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,1,1,1,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,

  // Row 5: p q r s t u v w x y z { | } ~ DEL
  1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 1,1,1,1,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,1,1,0,0,0, 0,0,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,1,0,1,0,1,0,0, 0,0,0,0,0,0,0,0,
  1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,1,0,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,0,0,0,1,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 1,0,1,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 0,0,0,1,0,0,0,0, 1,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,1,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  1,1,1,1,0,0,0,0, 1,0,0,0,1,0,0,0, 1,1,1,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 0,1,0,1,0,0,0,0, 1,0,1,0,1,0,0,0, 0,0,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  1,0,0,0,0,0,0,0, 1,0,1,0,1,0,0,0, 1,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,1,0,0,0, 0,1,0,1,0,0,0,0, 1,0,1,0,1,0,0,0, 0,1,0,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,1,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,1,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  1,0,0,0,0,0,0,0, 0,1,1,0,1,0,0,0, 1,0,0,1,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,0,1,0,0,0,0, 1,0,0,0,1,0,0,0, 0,0,1,0,0,0,0,0, 1,1,1,1,1,0,0,0, 0,0,1,1,0,0,0,0, 0,0,1,0,0,0,0,0, 0,1,1,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,
]);

// Get pixel data for a character
function getCharPixels(charCode: number): Uint8Array {
  // Map ASCII to font index (starting from space = 32)
  const index = charCode - 32;
  if (index < 0 || index >= 96) {
    return new Uint8Array(CHAR_WIDTH * CHAR_HEIGHT); // Return empty for invalid chars
  }

  // Calculate position in font data
  const row = Math.floor(index / CHARS_PER_ROW);
  const col = index % CHARS_PER_ROW;

  const pixels = new Uint8Array(CHAR_WIDTH * CHAR_HEIGHT);

  for (let y = 0; y < CHAR_HEIGHT; y++) {
    const srcRowOffset = (row * CHAR_HEIGHT + y) * (CHARS_PER_ROW * CHAR_WIDTH);
    const srcColOffset = col * CHAR_WIDTH;

    for (let x = 0; x < CHAR_WIDTH; x++) {
      pixels[y * CHAR_WIDTH + x] = fontData[srcRowOffset + srcColOffset + x];
    }
  }

  return pixels;
}

export interface BitmapFontOptions {
  scale?: number;
  color?: string;
  backgroundColor?: string;
}

// Render text to a canvas using the bitmap font
export function renderBitmapText(
  ctx: CanvasRenderingContext2D,
  text: string,
  x: number,
  y: number,
  options: BitmapFontOptions = {}
): void {
  const { scale = 1, color = '#888888', backgroundColor } = options;

  const scaledWidth = CHAR_WIDTH * scale;
  const scaledHeight = CHAR_HEIGHT * scale;

  // Draw background if specified
  if (backgroundColor) {
    ctx.fillStyle = backgroundColor;
    ctx.fillRect(x, y, text.length * scaledWidth, scaledHeight);
  }

  // Parse color
  const rgb = hexToRgb(color);

  for (let i = 0; i < text.length; i++) {
    const charCode = text.charCodeAt(i);
    const pixels = getCharPixels(charCode);
    const charX = x + i * scaledWidth;

    for (let py = 0; py < CHAR_HEIGHT; py++) {
      for (let px = 0; px < CHAR_WIDTH; px++) {
        if (pixels[py * CHAR_WIDTH + px]) {
          ctx.fillStyle = color;
          ctx.fillRect(
            charX + px * scale,
            y + py * scale,
            scale,
            scale
          );
        }
      }
    }
  }
}

// Create an offscreen canvas with rendered text
export function createTextCanvas(
  text: string,
  options: BitmapFontOptions = {}
): HTMLCanvasElement {
  const { scale = 1, color = '#888888', backgroundColor = 'transparent' } = options;

  const canvas = document.createElement('canvas');
  canvas.width = text.length * CHAR_WIDTH * scale;
  canvas.height = CHAR_HEIGHT * scale;

  const ctx = canvas.getContext('2d')!;

  if (backgroundColor !== 'transparent') {
    ctx.fillStyle = backgroundColor;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  renderBitmapText(ctx, text, 0, 0, { scale, color });

  return canvas;
}

// Helper function to convert hex color to RGB
function hexToRgb(hex: string): { r: number; g: number; b: number } {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result
    ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16),
      }
    : { r: 136, g: 136, b: 136 };
}

export const FONT_CHAR_WIDTH = CHAR_WIDTH;
export const FONT_CHAR_HEIGHT = CHAR_HEIGHT;
